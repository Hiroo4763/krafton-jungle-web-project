<!DOCTYPE html>
<html lang="ko">

<head>
    <!-- 이 부분은 절대 수정하지 마세요. -->
    <meta charset="UTF-8" />
    <meta name="assignment-type" content="type2">
    <title>PUBGTracker.gg</title>

    <!-- 부트스트랩 -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
        integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <!-- 이 부분은 절대 수정하지 마세요. -->

    <style type="text/css">
        div.question-box {
            margin: 10px 0 20px 0;
        }

        #loading {
            display: none;
        }
    </style>

    <!-- 부트스트랩 -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
        crossorigin="anonymous"></script>

    <script>
        let selectedPlatform = '';

        function selectPlatform(platform) {
            selectedPlatform = platform;
            $("#input-platform").text(platform);
        }

        function q1() {
            $("#result-box").empty(); // 결과 박스를 비웁니다.
            $('#loading').show();

            const API_KEY = "..."; // 여기에 자신의 PUBG API 키를 입력하세요

            // API를 이용해 배틀그라운드 전적을 검색, 플레이어 닉네임과 플랫폼 입력 필요
            let post_name = $('#input-player').val();
            let post_platform = selectedPlatform;
            $.ajax({
                type: "GET",
                url: `https://api.pubg.com/shards/${post_platform}/players?filter[playerNames]=${post_name}`,
                headers: {
                    "Authorization": `Bearer ${API_KEY}`,
                    "Accept": "application/vnd.api+json"
                },
                success: function (response) {
                    const playerName = response.data[0].attributes.name;
                    const platform = response.data[0].attributes.shardId;
                    const playerId = response.data[0].id;

                    // playerId를 사용해야, 전체 매치 정보를 가져올 수 있음, 따라서 2번 API 요청을 해야 함
                    $.ajax({
                        type: "GET",
                        url: `https://api.pubg.com/shards/${platform}/players/${playerId}/seasons/lifetime`,
                        headers: {
                            "Authorization": `Bearer ${API_KEY}`,
                            "Accept": "application/vnd.api+json"
                        },
                        success: function (responselifetime) {
                            const stats = responselifetime.data.attributes.gameModeStats;
                            const solo = stats.solo;  // solo 모드만

                            killand_losses = solo.kills / solo.losses; // K/D 계산
                            avglife_time = solo.timeSurvived / 60; // 초 단위로 변환
                            avglife_timeM = avglife_time / 60; // 분 단위로 변환

                            let temp_html = `
                                <div class="card mt-3 shadow-sm">
                                    <div class="card-body">
                                        <h4 class="card-title mb-3"><b>${playerName}</b> (플랫폼: <span class="text-primary">${platform}</span>)</h4>
                                        <ul class="list-group list-group-flush text-left">
                                            <li class="list-group-item"><b>총 경기 수</b>: ${solo.roundsPlayed}</li>
                                            <li class="list-group-item"><b>총 승리</b>: ${solo.wins}</li>
                                            <li class="list-group-item"><b>총 K/D</b>: ${killand_losses.toFixed(2)}</li>
                                            <li class="list-group-item"><b>평균 생존 시간</b>: ${avglife_timeM.toFixed(0)} 분</li>
                                        </ul>
                                    </div>
                                </div>
                            `;
                            $('#result-box').append(temp_html);
                            $('#loading').hide();
                        }
                    });
                },
                error: function (err) {
                    console.error("API 요청 실패:", err);
                }
            });
        }
    </script>
</head>

<body class="bg-light text-center">
    <h1 class="my-4"><b>PUBGTracker.gg</b></h1>
    <hr class="mb-4" style="border-top: 2px solid #343a40; width: 60%; margin: 0 auto;" />

    <div class="container">
        <div class="question-box bg-white p-4 rounded shadow-sm">
            <h2 class="mb-3">배틀그라운드 전적 검색</h2>
            <p class="text-muted mb-4">닉네임과 플랫폼을 선택한 후 검색하세요</p>

            <div class="search-box d-flex justify-content-center align-items-center mb-3 gap-2">
                <input id="input-player" type="text" class="form-control mr-2" placeholder="닉네임 입력"
                    style="max-width: 200px;" />

                <!-- 드롭다운 버튼 -->
                <div class="dropdown mr-2">
                    <button id="input-platform" class="btn btn-outline-secondary dropdown-toggle" type="button"
                        data-toggle="dropdown" aria-expanded="false">
                        플랫폼 선택
                    </button>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="#" onclick="selectPlatform('steam')">Steam</a>
                        <a class="dropdown-item" href="#" onclick="selectPlatform('kakao')">Kakao</a>
                    </div>
                </div>

                <button id="search-button" onclick="q1()" class="btn btn-primary">검색</button>
            </div>

            <div id="loading" class="text-info font-weight-bold" style="display: none;">불러오는 중...</div>

            <div id="result-box" class="mt-4 text-left"></div>
        </div>
    </div>
</body>

</html>