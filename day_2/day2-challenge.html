<!DOCTYPE html>
<html lang="ko">

<head>
    <!-- 이 부분은 절대 수정하지 마세요. -->
    <meta charset="UTF-8" />
    <meta name="assignment-type" content="type2">
    <title>PUBGTracker.gg</title>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <!-- 이 부분은 절대 수정하지 마세요. -->

    <style type="text/css">
        div.question-box {
            margin: 10px 0 20px 0;
        }

        #loading {
            display: none;
        }
    </style>

    <script>
        function q1() {
            $("#result-box").empty(); // 결과 박스를 비웁니다.
            $('#loading').show();

            const API_KEY = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIxZWE0MGY2MC01OTcxLTAxM2UtMGJmMS0zMmU2YzQ1YTMxZDciLCJpc3MiOiJnYW1lbG9ja2VyIiwiaWF0IjoxNzU0OTc5MDkzLCJwdWIiOiJibHVlaG9sZSIsInRpdGxlIjoicHViZyIsImFwcCI6Ii0xNWEwMGY3OC02YzhiLTQ3ZWEtODExMi1lMWU0N2FhMjIzZWQifQ.ibA8BXJq_vQqhhdAvrAv9E6Lc1lq9vmjw7G2wQUYmVg"

            // API를 이용해 배틀그라운드 전적을 검색, 플레이어 닉네임과 플랫폼 입력 필요
            let post_name = $('#input-player').val();
            let post_platform = $('#input-platform').val();
            $.ajax({
                type: "GET",
                url: `https://api.pubg.com/shards/${post_platform}/players?filter[playerNames]=${post_name}`,
                headers: {
                    "Authorization": `Bearer ${API_KEY}`,
                    "Accept": "application/vnd.api+json"
                },
                success: function (response) {
                    const playerName = response.data[0].attributes.name;
                    const platform = response.data[0].attributes.shardId;
                    const playerId = response.data[0].id;

                    // playerId를 사용해야, 전체 매치 정보를 가져올 수 있음, 따라서 2번 API 요청을 해야 함
                    $.ajax({
                        type: "GET",
                        url: `https://api.pubg.com/shards/${platform}/players/${playerId}/seasons/lifetime`,
                        headers: {
                            "Authorization": `Bearer ${API_KEY}`,
                            "Accept": "application/vnd.api+json"
                        },
                        success: function (responselifetime) {
                            const stats = responselifetime.data.attributes.gameModeStats;
                            const solo = stats.solo;  // solo 모드만

                            killand_losses = solo.kills / solo.losses; // K/D 계산
                            avglife_time = solo.timeSurvived / 60; // 초 단위로 변환
                            avglife_timeM = avglife_time / 60 ; // 분 단위로 변환

                            let temp_html = `<h3>플레이어 이름 ${playerName}<h3>`;
                            temp_html += `<p>플랫폼: ${platform}</p>`;
                            temp_html += `<p>총 경기 수: ${solo.roundsPlayed}</p>`;
                            temp_html += `<p>총 승리: ${solo.wins}</p>`;
                            temp_html += `<p>총 K/D: ${killand_losses}</p>`;
                            temp_html += `<p>평균 생존 시간: ${avglife_timeM} 분</p>`;

                            $('#result-box').append(temp_html);
                            $('#loading').hide();
                        }
                    });
                },
                error: function (err) {
                    console.error("API 요청 실패:", err);
                }
            });
        }
    </script>
</head>

<body>
    <h1>배틀그라운드 전적 검색</h1>

    <hr />

    <div class="question-box">
        <h2>PUBGTracker.gg</h2>
        <p>닉네임, 플랫폼 순서로 입력해주세요</p>
        <div class="search-box">
            <input id="input-player" type="text" />
            <input id="input-platform" type="text" />
        </div>
        <button id="search-button" onclick="q1()">검색</button>
        <div id="loading">불러오는 중...</div>
        <div id="result-box">


        </div>
</body>

</html>